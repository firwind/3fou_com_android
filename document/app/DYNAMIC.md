2018年01月04日10:51:35
# 动态 功能说明文档


### 动态数据发布
为了达到秒发与无网发送，动态的发布放在了后台任务进行处理，成功和失败通过`eventbus`通知前台；

### 动态列表获取与显示
进入动态页面后首先会获取本地数据，当本地数据为空时自动加载网络数据。

注意：当有动态后台没有发送完成的，会把发布的动态放在最新动态页面的最前面，当页面刷新时，如果动态已经发送成功，那么他就安时间顺序排在列表中。

### 动态分类说明
 注意：
- 动态分类通过`ApiConfig.DYNAMIC_TYPE_NEW`、`ApiConfig.DYNAMIC_TYPE_HOTS`、`ApiConfig.DYNAMIC_TYPE_FOLLOWS`标识；
 由于服务器返回的动态列表数据并没有分类标识，本地存储读取有进行标识古在`DynamicBean`中添加`hot_creat_time`、`isFollowed`分表标识是否是热门状态（热门状态`hot_creat_time`才会有内容）和是否关注；
。
- 在获取数据时犹豫`GreenDao`并不能更新指定字段内容，故在插入数据前，进行了数据迁移达到分类标识不被清掉。

- 因为需求在关注列表页需要显示自己的动态，故发布动态时把动态标记为已经关注

### 动态图片
#### 图片宽高

1. 当只有一张图片的时候 ：

    图片控件的宽度 = 当图片宽度 > 当前图片显示区域宽度 ? 当前图片显示区域宽度 ：当图片宽度
</br>

    图片控件的高度 = 当图片高度 > 当前图片显示区域宽度 * (4/3） ? 当前图片显示区域宽度 ：当图片高度

2. 当图片有多张的时候： 都显示为正方形，5张的时候除外，具体的请查看[视觉规范](https://github.com/zhiyicx/thinksns-plus-document/blob/master/TS%2B%E8%A7%86%E8%A7%89%E8%A7%84%E8%8C%83/TS+%E8%A7%86%E8%A7%89%E8%A7%84%E8%8C%83%202.2.pdf)

    宽高计算：with = height = （ 父控件宽度 - 间距的宽度 ）/ 当前图片所在行的列数 * 当前图片所占的份数

    份数：以当前行的最小图片为单位份数。

#### 图片压缩

      压缩比例 = (显示图片的控件的宽度 / 图片的真实宽度) * 100);

### 动态操作

所有操作都是直接更新 UI 与数据库，再把任务加入到后台；